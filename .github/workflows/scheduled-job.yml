name: Scheduled Job - Call Backend API and Notify Slack

on:
  schedule:
    - cron: '*/ * * * *'  # Every 5 minutes
  workflow_dispatch:

jobs:
  ping_and_notify:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ” Call /users endpoint
        id: call_api
        run: |
          RESPONSE=$(curl -s https://kjf8j25tbf.us-east-1.awsapprunner.com/users)
          echo "Fetched users: $RESPONSE"
          echo "response=$RESPONSE" >> $GITHUB_OUTPUT

     - name: ðŸ“£ Send Slack message
       run: |
         curl -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"âœ… Scheduled Job Ran at $(date '+%Y-%m-%d %H:%M:%S')\nResponse: ${{ steps.call_api.outputs.response }}\"}" \
          ${{ secrets.SLACK_WEBHOOK_URL }}

